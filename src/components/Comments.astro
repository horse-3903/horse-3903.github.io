---
const { pageTitle, pageUrl, pageId } = Astro.props;
---

<section id="comments" class="mt-12 mb-12">
  <div
    id="comments-card"
    class="card-base card-shadow overflow-hidden transition-all duration-500 relative"
  >
    <div class="p-6">
      <h2 class="text-2xl font-semibold mb-5 text-90 tracking-tight">
        Comments
      </h2>

      <div
        id="cusdis_thread"
        data-host="https://cusdis.com"
        data-app-id="a3ed583a-9ea0-4074-9249-f44ef13e6d9b"
        data-page-id={pageId}
        data-page-url={pageUrl}
        data-page-title={pageTitle}
        data-theme="auto"
      ></div>
    </div>
  </div>

  <!-- Load Cusdis -->
  <script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

  <!-- Initialize and sync theme -->
  <script is:inline>
    if (typeof window !== "undefined") {
      // Initialize Cusdis widget after script loads
      const init = () => window.CUSDIS?.initial?.();
      if (document.readyState === "loading") {
        window.addEventListener("DOMContentLoaded", init);
      } else {
        init();
      }

      // Automatically sync with Fuwari's dark/light toggle
      const updateCusdisTheme = () => {
        const theme = document.documentElement.classList.contains("dark")
          ? "dark"
          : "light";
        window.CUSDIS?.setTheme?.(theme);
      };

      const mo = new MutationObserver(updateCusdisTheme);
      mo.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ["class"],
      });

      // Apply once on load
      setTimeout(updateCusdisTheme, 1000);
    }
  </script>
</section>
